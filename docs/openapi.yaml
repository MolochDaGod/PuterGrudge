openapi: 3.1.0
info:
  title: CloudPilot AI Studio API
  version: 1.0.0
  description: |
    Autonomous AI Cloud Agent API for CloudPilot AI Studio.
    
    ## Features
    - **Grudge App**: Discord-style real-time chat with AI integration
    - **Launcher**: Quick app deployment and workflow management
    - **AI Agent**: Autonomous task execution with tool orchestration
    - **Extensions**: Modular agent capabilities
    - **Deployments**: Static site and game hosting
    - **Media Tools**: Image and 3D model conversion
    
    ## Authentication
    All state-changing endpoints require Puter authentication token.
    Pass the token via `Authorization: Bearer <token>` header.
    
    ## Rate Limiting
    - Standard: 100 requests/minute
    - AI endpoints: 20 requests/minute
    - Deployment endpoints: 10 requests/minute
  contact:
    name: CloudPilot Support
  license:
    name: MIT

servers:
  - url: /api/v1
    description: API Version 1

tags:
  - name: Core
    description: Health checks and application info
  - name: Grudge
    description: Real-time chat application endpoints
  - name: Launcher
    description: App launcher and quick actions
  - name: Agent
    description: AI agent task execution
  - name: Extensions
    description: Agent extension management
  - name: Deployments
    description: Site and game deployment
  - name: Media
    description: Image and 3D model tools
  - name: Integrations
    description: Third-party service integrations

paths:
  /health:
    get:
      tags: [Core]
      summary: Health check
      description: Returns API health status and service availability
      operationId: getHealth
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /info:
    get:
      tags: [Core]
      summary: Application info
      operationId: getInfo
      responses:
        '200':
          description: Application information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppInfo'

  /grudge/servers:
    get:
      tags: [Grudge]
      summary: List servers
      operationId: listGrudgeServers
      responses:
        '200':
          description: List of servers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      tags: [Grudge]
      summary: Create server
      operationId: createGrudgeServer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertGrudgeServer'
      responses:
        '201':
          description: Server created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /grudge/servers/{serverId}/channels:
    get:
      tags: [Grudge]
      summary: List channels in server
      operationId: listGrudgeChannels
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of channels
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      tags: [Grudge]
      summary: Create channel
      operationId: createGrudgeChannel
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertGrudgeChannel'
      responses:
        '201':
          description: Channel created

  /grudge/channels/{channelId}/messages:
    get:
      tags: [Grudge]
      summary: Get messages in channel
      operationId: getGrudgeMessages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: before
          in: query
          description: Message ID to fetch before
          schema:
            type: string
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      tags: [Grudge]
      summary: Send message
      operationId: sendGrudgeMessage
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertGrudgeMessage'
      responses:
        '201':
          description: Message sent

  /grudge/channels/{channelId}/messages/{messageId}/reactions:
    post:
      tags: [Grudge]
      summary: Add reaction to message
      operationId: addGrudgeReaction
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                emoji:
                  type: string
              required: [emoji]
      responses:
        '200':
          description: Reaction added

  /grudge/servers/{serverId}/members:
    get:
      tags: [Grudge]
      summary: List server members
      operationId: listGrudgeMembers
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of members

  /launcher/apps:
    get:
      tags: [Launcher]
      summary: List all launchable apps
      operationId: listLauncherApps
      responses:
        '200':
          description: List of apps
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /launcher/favorites:
    get:
      tags: [Launcher]
      summary: Get user favorites
      operationId: getLauncherFavorites
      responses:
        '200':
          description: List of favorites
    post:
      tags: [Launcher]
      summary: Add to favorites
      operationId: addLauncherFavorite
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                appId:
                  type: string
              required: [appId]
      responses:
        '201':
          description: Added to favorites

  /launcher/favorites/{appId}:
    delete:
      tags: [Launcher]
      summary: Remove from favorites
      operationId: removeLauncherFavorite
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Removed from favorites

  /launcher/activity:
    get:
      tags: [Launcher]
      summary: Get recent activity
      operationId: getLauncherActivity
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Recent activity events

  /launcher/launch/{appId}:
    post:
      tags: [Launcher]
      summary: Quick launch an app
      operationId: quickLaunch
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: App launched

  /improvement/suggestions:
    get:
      tags: [Launcher]
      summary: Get AI improvement suggestions
      operationId: getImprovementSuggestions
      responses:
        '200':
          description: List of suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /improvement/suggestions/{suggestionId}:
    patch:
      tags: [Launcher]
      summary: Apply or dismiss suggestion
      operationId: updateImprovementSuggestion
      parameters:
        - name: suggestionId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [applied, dismissed]
              required: [status]
      responses:
        '200':
          description: Suggestion updated

  /improvement/interactions:
    post:
      tags: [Launcher]
      summary: Track user interaction
      operationId: trackInteraction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InteractionEvent'
      responses:
        '201':
          description: Interaction tracked

  /improvement/stats:
    get:
      tags: [Launcher]
      summary: Get interaction statistics
      operationId: getInteractionStats
      responses:
        '200':
          description: Interaction statistics

  /agent/solve:
    post:
      tags: [Agent]
      summary: Submit problem for AI agent
      operationId: createAgentJob
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertAgentJob'
      responses:
        '201':
          description: Job created
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  status:
                    type: string
                  message:
                    type: string

  /agent/solve/{jobId}:
    get:
      tags: [Agent]
      summary: Get job status
      operationId: getAgentJob
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentJob'
        '404':
          description: Job not found

  /agent/jobs:
    get:
      tags: [Agent]
      summary: List all jobs
      operationId: listAgentJobs
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, processing, completed, failed]
      responses:
        '200':
          description: List of jobs

  /extensions:
    get:
      tags: [Extensions]
      summary: List all extensions
      operationId: listExtensions
      responses:
        '200':
          description: List of extensions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Extension'
    post:
      tags: [Extensions]
      summary: Register new extension
      operationId: createExtension
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertExtension'
      responses:
        '201':
          description: Extension created

  /extensions/{extensionId}:
    get:
      tags: [Extensions]
      summary: Get extension details
      operationId: getExtension
      parameters:
        - name: extensionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Extension details
        '404':
          description: Extension not found
    patch:
      tags: [Extensions]
      summary: Update extension
      operationId: updateExtension
      parameters:
        - name: extensionId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExtension'
      responses:
        '200':
          description: Extension updated
    delete:
      tags: [Extensions]
      summary: Delete extension
      operationId: deleteExtension
      parameters:
        - name: extensionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Extension deleted

  /deploy/sites:
    post:
      tags: [Deployments]
      summary: Deploy static site
      operationId: deploySite
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertDeployment'
      responses:
        '201':
          description: Deployment started

  /deploy/games:
    post:
      tags: [Deployments]
      summary: Deploy game server
      operationId: deployGame
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertDeployment'
      responses:
        '201':
          description: Game deployment started

  /deploy/templates:
    get:
      tags: [Deployments]
      summary: List game templates
      operationId: listGameTemplates
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GameTemplate'

  /deploy/templates/{templateId}:
    get:
      tags: [Deployments]
      summary: Get template with files
      operationId: getGameTemplate
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Template details
        '404':
          description: Template not found

  /deploy:
    get:
      tags: [Deployments]
      summary: List all deployments
      operationId: listDeployments
      responses:
        '200':
          description: List of deployments

  /deploy/{deploymentId}:
    get:
      tags: [Deployments]
      summary: Get deployment status
      operationId: getDeployment
      parameters:
        - name: deploymentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deployment details
        '404':
          description: Deployment not found
    patch:
      tags: [Deployments]
      summary: Update deployment
      operationId: updateDeployment
      parameters:
        - name: deploymentId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                config:
                  type: object
      responses:
        '200':
          description: Deployment updated
    delete:
      tags: [Deployments]
      summary: Delete deployment
      operationId: deleteDeployment
      parameters:
        - name: deploymentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deployment deleted

  /media/image/convert:
    post:
      tags: [Media]
      summary: Convert image format
      operationId: convertImage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                format:
                  type: string
                  enum: [webp, png, jpeg, jpg, avif]
                  default: webp
                width:
                  type: integer
                height:
                  type: integer
                quality:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 80
              required: [image]
      responses:
        '200':
          description: Converted image
          content:
            image/*:
              schema:
                type: string
                format: binary

  /media/3d/convert:
    post:
      tags: [Media]
      summary: Convert 3D model
      operationId: convert3dModel
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                model:
                  type: string
                  format: binary
                format:
                  type: string
                  enum: [glb, gltf]
                  default: glb
                optimize:
                  type: string
                  enum: [none, optimize]
                  default: none
              required: [model]
      responses:
        '200':
          description: Converted model
          content:
            model/gltf-binary:
              schema:
                type: string
                format: binary

  /integrations/crypto/news:
    get:
      tags: [Integrations]
      summary: Get crypto news
      operationId: getCryptoNews
      parameters:
        - name: filter
          in: query
          schema:
            type: string
            enum: [hot, rising, bullish, bearish, important, saved, lol]
            default: hot
        - name: currencies
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Crypto news feed

  /integrations/art/generate:
    post:
      tags: [Integrations]
      summary: Generate AI art
      operationId: generateArt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ArtGenerateRequest'
      responses:
        '200':
          description: Generated art

  /integrations/gbux/balance:
    get:
      tags: [Integrations]
      summary: Get GBUX balance
      operationId: getGbuxBalance
      responses:
        '200':
          description: GBUX balance info

  /integrations/discord/auth-url:
    get:
      tags: [Integrations]
      summary: Get Discord OAuth URL
      operationId: getDiscordAuthUrl
      responses:
        '200':
          description: Discord auth configuration

components:
  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        requestId:
          type: string
        timestamp:
          type: string
          format: date-time
      required: [success, timestamp]

    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        services:
          type: object
          properties:
            puterAI:
              type: boolean
            cryptopanic:
              type: boolean
            generativeArt:
              type: boolean
            gbux:
              type: boolean
            discord:
              type: boolean
        timestamp:
          type: string
          format: date-time
        version:
          type: string

    AppInfo:
      type: object
      properties:
        name:
          type: string
        version:
          type: string
        description:
          type: string
        environment:
          type: string
          enum: [development, production]

    GrudgeServer:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        icon:
          type: string
        ownerId:
          type: string
        createdAt:
          type: string
          format: date-time

    InsertGrudgeServer:
      type: object
      properties:
        name:
          type: string
        icon:
          type: string
        ownerId:
          type: string
      required: [name, icon, ownerId]

    GrudgeChannel:
      type: object
      properties:
        id:
          type: string
        serverId:
          type: string
        name:
          type: string
        type:
          type: string
          enum: [text, voice, announcement]
        description:
          type: string
        createdAt:
          type: string
          format: date-time

    InsertGrudgeChannel:
      type: object
      properties:
        serverId:
          type: string
        name:
          type: string
        type:
          type: string
          enum: [text, voice, announcement]
        description:
          type: string
      required: [serverId, name, type]

    GrudgeMessage:
      type: object
      properties:
        id:
          type: string
        channelId:
          type: string
        userId:
          type: string
        username:
          type: string
        content:
          type: string
        attachments:
          type: array
          items:
            type: string
        reactions:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
        isAI:
          type: boolean
        createdAt:
          type: string
          format: date-time
        editedAt:
          type: string
          format: date-time

    InsertGrudgeMessage:
      type: object
      properties:
        channelId:
          type: string
        userId:
          type: string
        username:
          type: string
        content:
          type: string
        attachments:
          type: array
          items:
            type: string
        isAI:
          type: boolean
      required: [channelId, userId, username, content]

    GrudgeMember:
      type: object
      properties:
        id:
          type: string
        serverId:
          type: string
        userId:
          type: string
        username:
          type: string
        status:
          type: string
          enum: [online, idle, dnd, offline]
        role:
          type: string
          enum: [owner, admin, moderator, member]
        joinedAt:
          type: string
          format: date-time

    LauncherApp:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        icon:
          type: string
        type:
          type: string
          enum: [app, workflow, deployment, external]
        url:
          type: string
        action:
          type: string
        category:
          type: string
        lastLaunched:
          type: string
          format: date-time
        launchCount:
          type: integer

    InteractionEvent:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [message_sent, channel_switch, server_switch, app_launch, workflow_run, ai_query, file_open, file_save, deployment_create]
        target:
          type: string
        metadata:
          type: object
        timestamp:
          type: string
          format: date-time

    ImprovementSuggestion:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [pin_channel, add_favorite, create_shortcut, optimize_workflow, suggest_automation]
        title:
          type: string
        description:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        actionData:
          type: object
        status:
          type: string
          enum: [pending, applied, dismissed]
        createdAt:
          type: string
          format: date-time

    AgentJob:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
          enum: [pending, processing, completed, failed]
        prompt:
          type: string
        context:
          type: string
        model:
          type: string
        result:
          type: string
        toolsUsed:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    InsertAgentJob:
      type: object
      properties:
        prompt:
          type: string
        context:
          type: string
        model:
          type: string
        tools:
          type: array
          items:
            type: string
      required: [prompt]

    Extension:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        version:
          type: string
        category:
          type: string
          enum: [ai, deployment, storage, tools, automation, custom]
        enabled:
          type: boolean
        config:
          type: object
        execute:
          type: string

    InsertExtension:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        version:
          type: string
        category:
          type: string
        config:
          type: object
        execute:
          type: string
      required: [id, name, description]

    UpdateExtension:
      type: object
      properties:
        enabled:
          type: boolean
        config:
          type: object

    Deployment:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [site, game, app]
        name:
          type: string
        subdomain:
          type: string
        status:
          type: string
          enum: [pending, deploying, live, failed, stopped]
        url:
          type: string
        template:
          type: string
        config:
          type: object
        logs:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    InsertDeployment:
      type: object
      properties:
        type:
          type: string
          enum: [site, game, app]
        name:
          type: string
        subdomain:
          type: string
        template:
          type: string
        config:
          type: object
        files:
          type: object
          additionalProperties:
            type: string
      required: [type, name, subdomain]

    GameTemplate:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        category:
          type: string
        files:
          type: object
          additionalProperties:
            type: string

    ArtGenerateRequest:
      type: object
      properties:
        prompt:
          type: string
        style:
          type: string
        width:
          type: integer
          default: 512
        height:
          type: integer
          default: 512
      required: [prompt]

  securitySchemes:
    PuterAuth:
      type: http
      scheme: bearer
      description: Puter authentication token

security:
  - PuterAuth: []
